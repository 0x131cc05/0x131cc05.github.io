<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"planarg.top","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言好早以前就有过写一下SCOI2018题解的想法了，毕竟是自己参加过的第一次省选。可惜当时我非常菜，啥都不会，然后就咕咕咕了 最近四川省重新组织了一场SCOI2018的重现赛，现在我来补一下题解 题目描述会尽可能还原原题的描述">
<meta property="og:type" content="article">
<meta property="og:title" content="SCOI2018 题解">
<meta property="og:url" content="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/index.html">
<meta property="og:site_name" content="PlanarG&#39;s blog">
<meta property="og:description" content="前言好早以前就有过写一下SCOI2018题解的想法了，毕竟是自己参加过的第一次省选。可惜当时我非常菜，啥都不会，然后就咕咕咕了 最近四川省重新组织了一场SCOI2018的重现赛，现在我来补一下题解 题目描述会尽可能还原原题的描述">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/1.png">
<meta property="og:image" content="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/2.png">
<meta property="og:image" content="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/3.png">
<meta property="article:published_time" content="2020-04-12T09:12:55.000Z">
<meta property="article:modified_time" content="2020-04-12T13:34:24.000Z">
<meta property="article:author" content="PlanarG">
<meta property="article:tag" content="线段树">
<meta property="article:tag" content="网络流">
<meta property="article:tag" content="LCT">
<meta property="article:tag" content="计算几何">
<meta property="article:tag" content="启发式合并">
<meta property="article:tag" content="二次剩余">
<meta property="article:tag" content="半平面交">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/1.png">

<link rel="canonical" href="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SCOI2018 题解 | PlanarG's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">PlanarG's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section">首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section">标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section">分类</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/friends/" rel="section">友链</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section">归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger">搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://planarg.top/2020/04/12/SCOI2018-%E9%A2%98%E8%A7%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/77041874_p0_master12001.jpg">
      <meta itemprop="name" content="PlanarG">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PlanarG's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SCOI2018 题解
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-12 17:12:55 / 修改时间：21:34:24" itemprop="dateCreated datePublished" datetime="2020-04-12T17:12:55+08:00">2020-04-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%80%83%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">考试</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>好早以前就有过写一下SCOI2018题解的想法了，毕竟是自己参加过的第一次省选。可惜当时我非常菜，啥都不会，然后就咕咕咕了</p>
<p>最近四川省重新组织了一场SCOI2018的重现赛，现在我来补一下题解</p>
<p>题目描述会尽可能还原原题的描述</p>
<a id="more"></a>
<h1 id="D1T1-树"><a href="#D1T1-树" class="headerlink" title="D1T1 树"></a>D1T1 树</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>在一棵大小为$n$的树上，点从$1$到$n$标号，第$i$个点的点权为$A_i$，要求支持两种操作</p>
<ul>
<li>$1\ u\,$询问从$u$出发的简单路径，经过的点权之和的最大值</li>
<li>$2\ u\ v\,$将$u$的权值修改为$v$</li>
</ul>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行两个整数$n,m$，表示树的大小和操作数</p>
<p>第二行$n - 1$个整数，第$i$个整数$p_i$表示$p_i$和$i + 1$有边相连</p>
<p>第三行$n$个整数，分别代表每个点的点权</p>
<p>接下来$m$行，每行描述一个操作，格式见题目描述</p>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每个询问操作，输出经过的点权之和的最大值</p>
<h2 id="数据范围"><a href="#数据范围" class="headerlink" title="数据范围"></a>数据范围</h2><p>对于$10\%$的数据，满足$n\leq 1000, m\leq 1000$</p>
<p>对于另$20\%$的数据，不存在修改操作</p>
<p>对于另$20\%$的数据，满足$p_i = i$</p>
<p>对于$100\%$的数据，满足$n, m\leq 10^5, -10^4\leq A_i, v\leq 10^4$</p>
<h2 id="题解"><a href="#题解" class="headerlink" title="题解"></a>题解</h2><p>在复现赛中，这道题的内存限制从<code>64MB</code>变成了<code>512MB</code></p>
<p>熟悉<code>LCT</code>维护虚子树的话可以看出，这道题实际上就是该算法的模板题</p>
<p>具体来说，考虑<code>LCT</code>剖出的每一条重链，该重链对应一棵<code>splay</code>。对于这棵<code>splay</code>上的每个节点，它在<code>splay</code>上的子树都对应原树中的一条子链。我们维护从这条子链的最浅点（即子树中最靠左的点）出发，在当前重链上只能经过<code>splay</code>上其子树内的点，并且可以从某个点走进虚儿子的最长路径长度。此外，我们还需要维护这条子链上的所有点（即<code>splay</code>子树中的点）的点权之和</p>
<p>对于每个点我们开一个<code>multiset</code>，维护从它的每个虚儿子走过来的最长路径。注意在<code>access</code>的时候需要修改</p>
<p>对于每个询问，直接将$u$<code>makeroot</code>，然后查询它对应的最长路径即可</p>
<p>如果在<code>makeroot</code>的时候翻转了<code>splay</code>，那么我们还需要额外维护从每条子链的最深点出发的最长路径</p>
<details>
<summary>代码</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> fa[N], ch[<span class="number">2</span>][N], sum[N], L[N], R[N], val[N], rev[N]; <span class="built_in">multiset</span>&lt;<span class="keyword">int</span>&gt; s[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">isroot</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123; <span class="keyword">return</span> (u != ch[<span class="number">0</span>][fa[u]] &amp;&amp; u != ch[<span class="number">1</span>][fa[u]]) || !u; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">child</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123; <span class="keyword">return</span> u == ch[<span class="number">1</span>][fa[u]]; &#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">connect</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f, <span class="keyword">int</span> son)</span> </span>&#123; fa[u] = f, ch[son][f] = u; &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    sum[u] = sum[ch[<span class="number">0</span>][u]] + sum[ch[<span class="number">1</span>][u]] + val[u]; <span class="keyword">int</span> t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (s[u].size()) t = max(t, *s[u].rbegin());</span><br><span class="line">    L[u] = max(L[ch[<span class="number">0</span>][u]], sum[ch[<span class="number">0</span>][u]] + val[u] + max(t, L[ch[<span class="number">1</span>][u]]));</span><br><span class="line">    R[u] = max(R[ch[<span class="number">1</span>][u]], sum[ch[<span class="number">1</span>][u]] + val[u] + max(t, R[ch[<span class="number">0</span>][u]]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Rev</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    swap(L[u], R[u]), swap(ch[<span class="number">0</span>][u], ch[<span class="number">1</span>][u]), rev[u] ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rev[u]) Rev(ch[<span class="number">0</span>][u]), Rev(ch[<span class="number">1</span>][u]), rev[u] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> f = fa[u], ff = fa[f], tmp = child(u), tmp1 = child(f);</span><br><span class="line">    <span class="keyword">if</span> (!isroot(f)) connect(u, ff, tmp1);</span><br><span class="line">    fa[u] = ff, connect(ch[tmp ^ <span class="number">1</span>][u], f, tmp), connect(f, u, tmp ^ <span class="number">1</span>), pushup(f), pushup(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> stk[N], top;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">splay</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    stk[top = <span class="number">1</span>] = u; <span class="keyword">int</span> t = u;</span><br><span class="line">    <span class="keyword">while</span> (!isroot(t)) stk[++top] = t = fa[t];</span><br><span class="line">    <span class="keyword">while</span> (top) pushdown(stk[top--]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> f; !isroot(u); rotate(u))</span><br><span class="line">        <span class="keyword">if</span> (!isroot(f = fa[u]))</span><br><span class="line">            rotate(child(u) ^ child(f) ? u : f);</span><br><span class="line">    pushup(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">access</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ls = <span class="number">0</span>; u; u = fa[ls = u]) &#123;</span><br><span class="line">        splay(u); </span><br><span class="line">        <span class="keyword">if</span> (ch[<span class="number">1</span>][u]) s[u].insert(L[ch[<span class="number">1</span>][u]]);</span><br><span class="line">        <span class="keyword">if</span> (ls) s[u].erase(s[u].find(L[ls]));</span><br><span class="line">        ch[<span class="number">1</span>][u] = ls, pushup(u);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">makeroot</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">    access(u), splay(u), Rev(u);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> p[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//    freopen("T1.in", "r", stdin), freopen("T1.out", "w", stdout);</span></span><br><span class="line">    <span class="keyword">int</span> n, q; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;q);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;p[i]);</span><br><span class="line">    L[<span class="number">0</span>] = R[<span class="number">0</span>] = <span class="number">-1e9</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) </span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;val[i]), L[i] = R[i] = sum[i] = val[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">2</span>; i--) </span><br><span class="line">        s[p[i]].insert(L[i]), L[p[i]] = R[p[i]] = max(L[p[i]], val[p[i]] + L[i]), fa[i] = p[i];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= q; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> op, a, b; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;op, &amp;a);</span><br><span class="line">        <span class="keyword">if</span> (op == <span class="number">1</span>) makeroot(a), <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, L[a]); </span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;b), makeroot(a), val[a] = b, pushup(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

注：由于没有测试数据，不保证代码的正确性
</details>

<h1 id="D1T2-Numazu-的蜜柑"><a href="#D1T2-Numazu-的蜜柑" class="headerlink" title="D1T2 Numazu 的蜜柑"></a>D1T2 Numazu 的蜜柑</h1><h2 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h2><p>蜜柑是 Numazu 的特产！这天 Chika 来到一棵蜜柑树下，发现这棵树由 $n$ 个结点组成（$1$号结点为根节点），每个结点都生长了一些蜜柑，结点 $u$ 的蜜柑数量记为 $a_u$ 。她想问聪明的你这样一个问题，有多少顶点对$(u,v)$满足：</p>
<ol>
<li>$v$是$u$的祖先</li>
<li>$a_u^2 + Aa_ua_v+Ba_v^2\equiv 0\pmod p$</li>
</ol>
<h2 id="输入格式-1"><a href="#输入格式-1" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行$4$个整数$n, p, A, B$</p>
<p>第二行包含$n$个整数$a_1, \cdots, a_n$</p>
<p>第三行包含$n - 1$个整数$fa_2, \cdots, fa_n$，分别代表每个点的父亲</p>
<h2 id="输出格式-1"><a href="#输出格式-1" class="headerlink" title="输出格式"></a>输出格式</h2><p>仅包含一行一个整数，为满足条件的顶点的数量</p>
<h2 id="数据范围-1"><a href="#数据范围-1" class="headerlink" title="数据范围"></a>数据范围</h2><p><img src="1.png" alt=""></p>
<p><img src="2.png" alt=""></p>
<script type="math/tex; mode=display">a_i, A, B,p\leq 10^{16}</script><h2 id="题解-1"><a href="#题解-1" class="headerlink" title="题解"></a>题解</h2><p>考虑枚举祖先$a_v$，将$a_v$看作常数，那么根据求根公式</p>
<script type="math/tex; mode=display">
a_u\equiv a_v\frac{-A \pm \sqrt{A^2 - 4B}}{2} \pmod p</script><p>求出$A^2 - 4B$在模$p$下的二次剩余，如果二次剩余不存在，那么当且仅当$a_u = a_v = 0$时方程成立</p>
<p>问题转化为统计每个点的子树内有多少个权值为$x$的点，启发式合并即可</p>
<details>
<summary> 代码 </summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> LL;</span><br><span class="line"><span class="keyword">typedef</span> pair&lt;LL, LL&gt; P;</span><br><span class="line"></span><br><span class="line">LL mod;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">mul</span><span class="params">(LL a, LL b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (a * b - (LL)((<span class="keyword">long</span> <span class="keyword">double</span>)a / mod * b) * mod + mod) % mod;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">Pow</span><span class="params">(LL x, LL y)</span> </span>&#123;</span><br><span class="line">    LL res = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, x = mul(x, x)) <span class="keyword">if</span> (y &amp; <span class="number">1</span>) res = mul(res, x);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> LL <span class="title">Cipolla</span><span class="params">(LL x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (Pow(x, (mod - <span class="number">1</span>) / <span class="number">2</span>) != <span class="number">1</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    LL a = rand() % mod;</span><br><span class="line">    <span class="keyword">while</span> (Pow((mul(a, a) - x + mod) % mod, (mod - <span class="number">1</span>) / <span class="number">2</span>) != mod - <span class="number">1</span>) a = rand() % mod;</span><br><span class="line">    LL t = (mul(a, a) - x + mod) % mod;</span><br><span class="line">    <span class="keyword">auto</span> Mul = [&amp;](P a, P b) -&gt; P &#123;</span><br><span class="line">        LL A = (mul(a.first, b.first) + mul(a.second, mul(b.second, t))) % mod;</span><br><span class="line">        LL B = (mul(a.first, b.second) + mul(a.second, b.first)) % mod;</span><br><span class="line">        <span class="keyword">return</span> P(A, B);</span><br><span class="line">    &#125;;</span><br><span class="line">    P res(1, 0), tmp(a, 1); LL y = (mod + 1) / 2;</span><br><span class="line">    <span class="keyword">for</span> (; y; y &gt;&gt;= <span class="number">1</span>, tmp = Mul(tmp, tmp)) <span class="keyword">if</span> (y &amp; <span class="number">1</span>) res = Mul(res, tmp);</span><br><span class="line">    <span class="keyword">return</span> res.first;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">100010</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> to, next;</span><br><span class="line">&#125; e[N * <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> head[N], ecnt;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">adde</span><span class="params">(<span class="keyword">int</span> from, <span class="keyword">int</span> to)</span> </span>&#123;</span><br><span class="line">    e[++ecnt] = (edge)&#123;to, head[from]&#125;, head[from] = ecnt;</span><br><span class="line">    e[++ecnt] = (edge)&#123;from, head[to]&#125;, head[to] = ecnt;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LL num[N], t1, t2, res; <span class="built_in">map</span>&lt;LL, <span class="keyword">int</span>&gt; mp[N]; <span class="keyword">int</span> RT[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (mp[RT[a]].size() &gt; mp[RT[b]].size()) swap(a, b);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> t : mp[RT[a]]) mp[RT[b]][t.first] += t.second;</span><br><span class="line">    mp[RT[a]].clear(), RT[a] = RT[b];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> f)</span> </span>&#123;</span><br><span class="line">    RT[u] = u;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = head[u]; i; i = e[i].next)</span><br><span class="line">        <span class="keyword">if</span> (e[i].to != f) </span><br><span class="line">            dfs(e[i].to, u), merge(u, e[i].to);</span><br><span class="line">    <span class="keyword">if</span> (t1 == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!u) res += mp[RT[u]][<span class="number">0</span>];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res += mp[RT[u]][mul(num[u], t1)];</span><br><span class="line">        <span class="keyword">if</span> (t1 != t2) res += mp[RT[u]][mul(num[u], t2)];</span><br><span class="line">    &#125;</span><br><span class="line">    mp[RT[u]][num[u]]++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    srand((LL)<span class="keyword">new</span> <span class="keyword">char</span>);</span><br><span class="line">    <span class="keyword">int</span> n; LL A, B; <span class="built_in">scanf</span>(<span class="string">"%d%lld%lld%lld"</span>, &amp;n, &amp;mod, &amp;A, &amp;B);</span><br><span class="line">    LL tmp = ((mul(A, A) - <span class="number">4</span> * B) % mod + mod) % mod, inv2 = (mod + <span class="number">1</span>) / <span class="number">2</span>; tmp = Cipolla(tmp);</span><br><span class="line">    <span class="keyword">if</span> (tmp == <span class="number">-1</span>) t1 = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        t1 = (tmp - A + mod) % mod, t2 = (-tmp - A + <span class="number">2</span> * mod) % mod;</span><br><span class="line">        t1 = mul(t1, inv2), t2 = mul(t2, inv2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;num[i]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>, a; i &lt;= n; i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;a), adde(a, i);</span><br><span class="line">    dfs(<span class="number">1</span>, <span class="number">0</span>), <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
不保证代码的正确性
</details>

<h1 id="D1T3-星际迷航"><a href="#D1T3-星际迷航" class="headerlink" title="D1T3 星际迷航"></a>D1T3 星际迷航</h1><h2 id="题目描述-2"><a href="#题目描述-2" class="headerlink" title="题目描述"></a>题目描述</h2><p>“如果宇宙中真有什么终极的逻辑，那就是终有一天我们会在舰桥上重逢，直到生命的终结，对于我们来说旅途的本身就是归宿。”，小 $7$ 一边说着一边凭借曲率引擎在宇宙中航行着，他十分在意自己能否到达他所想的时空坐标。确切的说在现代科学的描述中，空间、时间以及某些未知的要素构成的时空坐标可以描述为一个 $m$ 维空间，初始可以假设小 $7$ 所在的位置就是空间的原点。在 $m$ 维时空中存在着 $n$ 个已经探明的奇点，而曲率引擎的移动方法为：先选择一个奇点，然后借‘力’穿越到关于该点对称的时空坐标。小 $7$ 非常关心自己能否通过有限次移动到达他所想去的地方，现在请你来回答这个问题。</p>
<p>小 $7$ 想了想觉得这个问题很难，为了不为难你弱化了判定条件，他会给你一个数字 $p$，只要你能到达一个空间坐标，且每一维都与目标坐标在模 $p$ 意义下同余即认为可以到达目标。</p>
<h2 id="输入格式-2"><a href="#输入格式-2" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行包含四个空格隔开的正整数 $n$、$m$、$q$ 和 $p$，分别表示奇点的数量、空间的维度、询问的数量和模数。</p>
<p>接下来 $n$ 行，每行 $m$ 个整数，依次表示时空中每个奇点的空间坐标。</p>
<p>接下来 $q$ 行，每行 $m$ 个整数，表示询问小 $7$ 能否到达这个时空坐标。</p>
<h2 id="输出格式-2"><a href="#输出格式-2" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出 $q$ 行，每行用<code>YES</code>和<code>NO</code>表示对于每个询问可否到达。</p>
<h2 id="题解-2"><a href="#题解-2" class="headerlink" title="题解"></a>题解</h2><p>这题我暂时还不会，如果以后会了应该会回来补/kel</p>
<h1 id="D2T1-维护序列"><a href="#D2T1-维护序列" class="headerlink" title="D2T1 维护序列"></a>D2T1 维护序列</h1><p>题目记不太清了，毕竟都隔了两年了。在复现赛的时候这道题被替换成了SCOI2019的D2T2，也就是RGB那道题</p>
<h2 id="简化版题面"><a href="#简化版题面" class="headerlink" title="简化版题面"></a>简化版题面</h2><p>有一个长度为$n$的序列，有$q$个询问。每次询问给出$l, r, x$，表示你可以选择$l$到$r$中任意三个连续的数，然后将这三个数都加上$x$，询问最终序列每个数绝对值之和的最大值。注意询问没有后效性</p>
<h2 id="数据范围-2"><a href="#数据范围-2" class="headerlink" title="数据范围"></a>数据范围</h2><script type="math/tex; mode=display">n, q\leq 10^5, |x|\leq \mathrm{int\_max}</script><h2 id="题解-3"><a href="#题解-3" class="headerlink" title="题解"></a>题解</h2><p>将绝对值拆开，$|a + b| = \max(a + b, -a - b)$，然后大概就没了</p>
<p>由于最后求的是答案的最大值，而这个绝对值只有当被正确计算的时候才最大，因此我们可以直接将$\max$扔掉。此时相邻的三个数拆开之后一共有$8$种可能，线段树分别维护这$8$个值即可</p>
<p>另一种思路是考虑$y = |x + a|$构成的图像，三个这种图像叠加起来构成的图像分为四段，斜率从左到右分别为$-3, -1, 1, 3$，使用线段树分别维护这四段函数。同样，这个分段函数的值当且仅当被正确计算的时候才最大，因此我们可以将分段函数拆成四条直线，维护这四条直线即可</p>
<p>没有代码</p>
<h1 id="D2T2-游泳池"><a href="#D2T2-游泳池" class="headerlink" title="D2T2 游泳池"></a>D2T2 游泳池</h1><h2 id="题目描述-3"><a href="#题目描述-3" class="headerlink" title="题目描述"></a>题目描述</h2><p>淘淘家的后院有一个巨大的凸多边形游泳池，泳池包含 $n$ 个顶点。泳池内有  $m$ 座圆形石雕，环境十分优雅。每天清晨，淘淘都会在泳池池边随机选取一个起点，开始她今天的游泳活动。为了达到更好的健身效果，淘淘会找到与起点直线距离最远的顶点作为终点，并尽可能以直线的方式从起点游到终点。抵达终点之后，淘淘希望可以泡在水中欣赏四周的风景，随后开启心情舒畅的一天。</p>
<p>然而，淘淘也有心情不舒畅的时候。一方面，不是每个顶点处都有优美的风景，倘若淘淘选取风景不优美的顶点作为终点，这会导致她当天心情不舒畅；另一方面，淘淘发现了石雕十分碍事，倘若淘淘从起点到终点的直线路线被石雕所阻挡，那么她必须改变游泳路线，这也会导致她当天心情不舒畅。</p>
<p>暑假即将来临，面对连续的 $t$ 天假期，淘淘已经有些迫不及待了。经过认真的数学计算，淘淘发现她心情舒畅的期望天数居然少得可怜！经过认真分析，她认为那些碍事的石雕才是罪魁祸首。为此，她决定开展泳池改造计划——移除石雕。具体地讲，淘淘移除一块石雕需要花费 $k$ 天，并且在此期间她并不会心情舒畅。淘淘可以使用暑假开始前的额外 $k\times r$ 天来移除 $r$ 座石雕（$r$ 的数值由淘淘自己决定，可以为 $0$）。</p>
<p>淘淘一方面希望提升她心情舒畅的期望天数，但她更关心心情舒畅的期望天数占总天数$(t+r\times k)$的比例可以有多大。现在，淘淘找到了聪明的你来协助她设计泳池改造计划，并计算这个比值的最大值。</p>
<h2 id="输入格式-3"><a href="#输入格式-3" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行包含四个整数 $n, m, t, k$，其中 $n$ 表示凸多边形泳池的顶点数量，$m$ 表示泳池内圆形石雕的数量，$t$ 表示淘淘即将游泳的天数，$k$ 表示拆除一个石雕所需要的天数；</p>
<p>随后 $n$ 行，沿逆时针方向描述泳池的 $n$ 个顶点，每行三个整数 $X_i, Y_i, A_i$，依次表示顶点的横、纵坐标以及风景是否优美，$A_i=1$ 表示优美，$A_i=0$ 表示不优美；</p>
<p>随后 $m$ 行，描述泳池内的 $m$ 个圆形石雕，每行三个整数 $C_i, D_i, R_i$，依次表示圆心的横、纵坐标以及半径，数据保证石雕与石雕不会重合，石雕也不会超出泳池边界。</p>
<h2 id="输出格式-3"><a href="#输出格式-3" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出一个浮点数，表示心情舒畅的期望天数占总天数比例的最大值。输出的结果须保留 $4$ 位小数，当你的答案与标准答案的误差不超过 $0.001$ 时视为正确。</p>
<h2 id="数据范围-3"><a href="#数据范围-3" class="headerlink" title="数据范围"></a>数据范围</h2><p>对于 $30\%$ 的数据，$m=0$，即没有石雕；</p>
<p>另有 $30\%$ 的数据，$t=1, k=10^6$，此种情况下无需拆除石雕；</p>
<p>另有 $20\%$ 的数据，$m\leq 10$；</p>
<p>对于 $100\%$ 的数据，$4\leq n\leq 500, m\leq 50, t\leq 10^4, k\leq 10^6$；</p>
<p>对于 $100\%$ 的数据，所有坐标、半径的绝对值不超过 $10^7$。</p>
<h2 id="题解-4"><a href="#题解-4" class="headerlink" title="题解"></a>题解</h2><p>首先如果没有石雕，怎么统计答案</p>
<p>考虑将游泳过程倒过来，即考虑最终游到的目标点，求出多边形上有哪些点最终会游到这个目标点</p>
<p>相当于在多边形上找到一个范围，使得这个范围内的所有点距离这个顶点的距离最远</p>
<p>枚举这个顶点$i$，然后再枚举其它的每个顶点$j$，最终范围内的所有点到$i$的距离必须大于到$j$的距离。作出$i, j$连线的中位线，显然这个范围内的所有点都必须在这条中位线靠近$j$的那一侧</p>
<p>因此，将原多边形的所有边以及我们新添加的这$n - 1$条直线拿来做半平面交，就可以得到这个范围。我们将其称作$i$“控制”这个范围内的所有点</p>
<p>如果不能移除石雕，枚举顶点$i$之后再枚举多边形的每一条边$j$，然后将所有的石雕拿来求切线，并求出切线与$j$的交点。然后我们就可以在$j$上跑扫描线，只有那些未被石雕覆盖的点对答案才有贡献</p>
<p>如果能移除一些石雕，我们假设通过移除$k$个石雕能使得期望天数增加$x’$，原来的期望天数为$x$，考虑分数规划二分的过程，假设二分的答案为$mid$</p>
<script type="math/tex; mode=display">
\begin{gathered}
\frac{x + x'}{t + rk}\geq mid \Rightarrow x + x'\geq mid(t + rk)\\
x' - k\times(mid\times r) \geq mid\times t - x
\end{gathered}</script><p>我们将$x’$看作最终的价值，每移除一个石雕就扣除$mid\times r$的价值，然后要使得最终的方案的价值最大</p>
<p>这很明显是一个最小割的模型，在刚刚的扫描线的过程中我们可以顺便求出每一段被哪些石雕遮挡，要么不要这一段的价值，要么扣除移除这些石雕的代价，网络流即可</p>
<p>代码很长，可以看<a href="https://www.cnblogs.com/ImagineC/p/10121566.html" target="_blank" rel="noopener">这个</a></p>
<details>
<summary>还是贴一下</summary>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">510</span>, max_node = <span class="number">3e4</span> + <span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">double</span> eps = <span class="number">1e-10</span>, inf = <span class="number">1e9</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">point</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> id;</span><br><span class="line">  <span class="keyword">double</span> x, y;</span><br><span class="line"></span><br><span class="line">  point () &#123;&#125;</span><br><span class="line">  point (<span class="keyword">double</span> x, <span class="keyword">double</span> y): x(x), y(y) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  point <span class="keyword">operator</span> + (point a) &#123;</span><br><span class="line">    <span class="keyword">return</span> point (x + a.x, y + a.y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  point <span class="keyword">operator</span> - (point a) &#123;</span><br><span class="line">    <span class="keyword">return</span> point (x - a.x, y - a.y);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  point <span class="keyword">operator</span> * (<span class="keyword">double</span> a) &#123;</span><br><span class="line">    <span class="keyword">return</span> point (x * a, y * a);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  point <span class="keyword">operator</span> / (<span class="keyword">double</span> a) &#123;</span><br><span class="line">    <span class="keyword">return</span> point (x / a, y / a);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> == (<span class="keyword">const</span> point&amp; a) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fabs</span>(x - a.x) &lt; eps &amp;&amp; <span class="built_in">fabs</span>(y - a.y) &lt; eps;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> != (<span class="keyword">const</span> point&amp; a) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> !(*<span class="keyword">this</span> == a);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; points[N], point_q[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dot</span><span class="params">(point a, point b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a.x * b.x + a.y * b.y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">cross</span><span class="params">(point a, point b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a.x * b.y - a.y * b.x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dist</span><span class="params">(point a, point b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sqrt</span>(dot(a - b, a - b));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">point <span class="title">rotate</span><span class="params">(point a, <span class="keyword">double</span> rad)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> point (a.x * <span class="built_in">cos</span>(rad) - a.y * <span class="built_in">sin</span>(rad), a.x * <span class="built_in">sin</span>(rad) + a.y * <span class="built_in">cos</span>(rad));</span><br><span class="line">&#125;       </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">on_segment</span><span class="params">(point p, point a, point b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">double</span> d = dist(a, b);</span><br><span class="line">  <span class="keyword">return</span> dist(a, p) &lt;= d &amp;&amp; dist(b, p) &lt;= d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">circle</span> &#123;</span></span><br><span class="line">  point center;</span><br><span class="line">  <span class="keyword">double</span> r;</span><br><span class="line"></span><br><span class="line">  circle () &#123;&#125;</span><br><span class="line">  circle (point center, <span class="keyword">double</span> r): center(center), r(r) &#123;&#125;</span><br><span class="line">&#125; stone[N];</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">line</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> id;</span><br><span class="line">  point p, v;</span><br><span class="line">  <span class="keyword">double</span> angle;</span><br><span class="line"></span><br><span class="line">  line () &#123;&#125;</span><br><span class="line">  line (point p, point v, <span class="keyword">int</span> id): p(p), v(v), id(id) &#123;</span><br><span class="line">    angle = <span class="built_in">atan2</span>(v.y, v.x);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> line&amp; a) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> angle &lt; a.angle;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; line_q[N &lt;&lt; <span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> n, m, days, cost, type[N];</span><br><span class="line"><span class="keyword">double</span> p0, all_dist;</span><br><span class="line"><span class="built_in">vector</span>&lt;pair&lt;point, point&gt;&gt; control[N][N];</span><br><span class="line"></span><br><span class="line"><span class="function">point <span class="title">line_intersection</span><span class="params">(line a, line b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">fabs</span>(cross(a.v, b.v)) &gt; eps) &#123;</span><br><span class="line">    <span class="keyword">double</span> t = cross(b.v, a.p - b.p) / cross(a.v, b.v);</span><br><span class="line">    <span class="keyword">return</span> a.p + a.v * t;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> point (inf, inf);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">on_left</span><span class="params">(point p, line x)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> cross(x.v, p - x.p) &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">vector</span>&lt;line&gt; <span class="title">half_plane_intersection</span><span class="params">(<span class="built_in">vector</span>&lt;line&gt;&amp; s)</span> </span>&#123;</span><br><span class="line">  sort(s.begin(), s.end());</span><br><span class="line">  <span class="keyword">int</span> first = <span class="number">0</span>, last = <span class="number">0</span>;</span><br><span class="line">  line_q[<span class="number">0</span>] = s[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; s.size(); ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (; first &lt; last &amp;&amp; !on_left(point_q[last - <span class="number">1</span>], s[i]); --last);</span><br><span class="line">    <span class="keyword">for</span> (; first &lt; last &amp;&amp; !on_left(point_q[first], s[i]); ++first);</span><br><span class="line">    line_q[++last] = s[i];</span><br><span class="line">    <span class="keyword">if</span> (first &lt; last &amp;&amp; <span class="built_in">fabs</span>(cross(line_q[last].v, line_q[last - <span class="number">1</span>].v)) &lt; eps) &#123;</span><br><span class="line">      --last;</span><br><span class="line">      <span class="keyword">if</span> (on_left(s[i].p, line_q[last])) &#123;</span><br><span class="line">        line_q[last] = s[i];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (first &lt; last) &#123;</span><br><span class="line">      point_q[last - <span class="number">1</span>] = line_intersection(line_q[last - <span class="number">1</span>], line_q[last]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (; first &lt; last &amp;&amp; !on_left(point_q[last - <span class="number">1</span>], line_q[first]); --last);</span><br><span class="line">  <span class="built_in">vector</span>&lt;line&gt; result;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = first; i &lt;= last; ++i) &#123;</span><br><span class="line">    result.push_back(line_q[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">edge</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> to;</span><br><span class="line">  <span class="keyword">double</span> refer, cap, flow;</span><br><span class="line"></span><br><span class="line">  edge () &#123;&#125;</span><br><span class="line">  edge (<span class="keyword">int</span> to, <span class="keyword">double</span> refer): to(to), refer(refer) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;edge&gt; edges;</span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; graph[max_node];</span><br><span class="line"><span class="keyword">int</span> s, t, node_cnt, stone_id[N], cur[max_node], dis[max_node];</span><br><span class="line"><span class="keyword">double</span> dinic_flow;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">double</span> cap)</span> </span>&#123;</span><br><span class="line">  edges.emplace_back(v, cap);</span><br><span class="line">  edges.emplace_back(u, <span class="number">0</span>);</span><br><span class="line">  graph[u].push_back(edges.size() - <span class="number">2</span>);</span><br><span class="line">  graph[v].push_back(edges.size() - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">bfs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">queue</span>&lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">  <span class="built_in">memset</span>(dis, <span class="number">0</span>, <span class="keyword">sizeof</span> dis);</span><br><span class="line">  <span class="built_in">memset</span>(cur, <span class="number">0</span>, <span class="keyword">sizeof</span> cur);</span><br><span class="line">  que.push(s);</span><br><span class="line">  dis[s] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">    <span class="keyword">int</span> x = que.front();</span><br><span class="line">    que.pop();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> v : graph[x]) &#123;</span><br><span class="line">      edge&amp; e = edges[v];</span><br><span class="line">      <span class="keyword">if</span> (e.cap - e.flow &gt; eps &amp;&amp; !dis[e.to]) &#123;</span><br><span class="line">        dis[e.to] = dis[x] + <span class="number">1</span>;</span><br><span class="line">        que.push(e.to);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dis[t] &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">double</span> a)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (u == t || a &lt; eps) &#123;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">double</span> flow = <span class="number">0</span>, f;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span>&amp; i = cur[u]; i &lt; graph[u].size(); ++i) &#123;</span><br><span class="line">      edge&amp; e = edges[graph[u][i]];</span><br><span class="line">      <span class="keyword">if</span> (dis[e.to] == dis[u] + <span class="number">1</span> &amp;&amp; (f = dfs(e.to, min(a, e.cap - e.flow))) &gt; eps) &#123;</span><br><span class="line">        e.flow += f;</span><br><span class="line">        edges[graph[u][i] ^ <span class="number">1</span>].flow -= f;</span><br><span class="line">        flow += f;</span><br><span class="line">        a -= f;</span><br><span class="line">        <span class="keyword">if</span> (a &lt; eps) &#123;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> flow;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (; bfs(); dinic_flow -= dfs(s, inf));</span><br><span class="line">  <span class="keyword">return</span> dinic_flow;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">state</span> &#123;</span></span><br><span class="line">  <span class="keyword">int</span> p_id, stone_id;</span><br><span class="line">  <span class="keyword">double</span> d;</span><br><span class="line">  point p;</span><br><span class="line"></span><br><span class="line">  state () &#123;&#125;</span><br><span class="line">  state (<span class="keyword">int</span> p_id, <span class="keyword">int</span> stone_id, <span class="keyword">double</span> d, point p): p_id(p_id), stone_id(stone_id), d(d), p(p) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> state&amp; a) <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> p_id == a.p_id ? d &lt; a.d : p_id &lt; a.p_id;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">vector</span>&lt;state&gt; cover[N];</span><br><span class="line"><span class="keyword">bool</span> appeared[N];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_edge</span><span class="params">(<span class="keyword">int</span> i, <span class="keyword">int</span> j, point a, point b)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (control[i][j].size()) &#123;</span><br><span class="line">    point p = control[i][j][<span class="number">0</span>].first;</span><br><span class="line">    point q = control[i][j][<span class="number">0</span>].second;</span><br><span class="line">    <span class="keyword">double</span> dist0 = dist(points[j], p);</span><br><span class="line">    <span class="keyword">double</span> dist1 = dist(points[j], a);</span><br><span class="line">    <span class="keyword">double</span> dist2 = dist(points[j], q);</span><br><span class="line">    <span class="keyword">double</span> dist3 = dist(points[j], b);</span><br><span class="line">    <span class="keyword">if</span> (max(dist0, dist1) &lt;= min(dist2, dist3)) &#123;</span><br><span class="line">      point l = dist0 &gt; dist1 ? p : a;</span><br><span class="line">      point r = dist2 &lt; dist3 ? q : b;</span><br><span class="line">      ++node_cnt;</span><br><span class="line">      <span class="keyword">double</span> d = dist(l, r) / all_dist;</span><br><span class="line">      p0 -= d;</span><br><span class="line">      add_edge(s, node_cnt, d * days);</span><br><span class="line">      dinic_flow += d * days;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= m; ++k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (appeared[k]) &#123;</span><br><span class="line">          add_edge(node_cnt, stone_id[k], inf);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add_edge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  s = ++node_cnt;</span><br><span class="line">  t = ++node_cnt;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">    stone_id[i] = ++node_cnt;</span><br><span class="line">    add_edge(stone_id[i], t, -cost);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type[i]) &#123;</span><br><span class="line">      <span class="built_in">memset</span>(appeared, <span class="literal">false</span>, <span class="keyword">sizeof</span> appeared);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>, k, last = <span class="number">-1</span>; j &lt; cover[i].size(); j = k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (~last) &#123;</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> l = last == n ? <span class="number">1</span> : last + <span class="number">1</span>; l != cover[i][j].p_id; l = l == n ? <span class="number">1</span> : l + <span class="number">1</span>) &#123;</span><br><span class="line">            add_edge(i, l, points[l], points[l == n ? <span class="number">1</span> : l + <span class="number">1</span>]);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (k = j; k &lt; cover[i].size() &amp;&amp; cover[i][j].p_id == cover[i][k].p_id; ++k);</span><br><span class="line">        last = cover[i][j].p_id;</span><br><span class="line">        add_edge(i, last, points[last], cover[i][j].p);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> l = j; l &lt; k; ++l) &#123;</span><br><span class="line">          <span class="keyword">int</span> u = cover[i][l].stone_id;</span><br><span class="line">          <span class="keyword">if</span> (!appeared[u]) &#123;</span><br><span class="line">            appeared[u] = <span class="literal">true</span>;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            appeared[u] = <span class="literal">false</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">if</span> (l + <span class="number">1</span> &lt; k) &#123;</span><br><span class="line">            add_edge(i, last, cover[i][l].p, cover[i][l + <span class="number">1</span>].p);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        add_edge(i, last, cover[i][k - <span class="number">1</span>].p, points[last == n ? <span class="number">1</span> : last + <span class="number">1</span>]);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">(<span class="keyword">double</span> answer)</span> </span>&#123;</span><br><span class="line">  dinic_flow = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; v : edges) &#123;</span><br><span class="line">    v.flow = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (v.refer &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">      v.cap = v.refer;</span><br><span class="line">      <span class="keyword">if</span> (v.refer &lt; inf) &#123;</span><br><span class="line">        dinic_flow += v.refer;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      v.cap = -answer * v.refer;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (p0 - answer) * days + dinic() &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;n, &amp;m, &amp;days, &amp;cost);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf%lf%d"</span>, &amp;points[i].x, &amp;points[i].y, &amp;type[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type[i]) &#123;</span><br><span class="line">      <span class="built_in">vector</span>&lt;line&gt; half_plane;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; ++j) &#123;</span><br><span class="line">        <span class="keyword">int</span> k = j == n ? <span class="number">1</span> : j + <span class="number">1</span>;</span><br><span class="line">        half_plane.emplace_back(points[j], points[k] - points[j], j);</span><br><span class="line">        <span class="keyword">if</span> (i != j) &#123;</span><br><span class="line">          point mid = point ((points[i].x + points[j].x) / <span class="number">2</span>, (points[i].y + points[j].y) / <span class="number">2</span>);</span><br><span class="line">          point v = point (points[j].y - points[i].y, points[i].x - points[j].x);</span><br><span class="line">          half_plane.emplace_back(mid, v, <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">vector</span>&lt;line&gt; convex_hull = half_plane_intersection(half_plane);</span><br><span class="line">      <span class="keyword">if</span> (convex_hull.size() &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; convex_hull.size(); ++j) &#123;</span><br><span class="line">          <span class="keyword">if</span> (~convex_hull[j].id) &#123;</span><br><span class="line">            <span class="keyword">int</span> l = j == <span class="number">0</span> ? convex_hull.size() - <span class="number">1</span> : j - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> r = j + <span class="number">1</span> == convex_hull.size() ? <span class="number">0</span> : j + <span class="number">1</span>;</span><br><span class="line">            point a = line_intersection(convex_hull[l], convex_hull[j]);</span><br><span class="line">            point b = line_intersection(convex_hull[j], convex_hull[r]);</span><br><span class="line">            p0 += dist(a, b);</span><br><span class="line">            control[i][convex_hull[j].id].emplace_back(a, b);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">int</span> j = i == n ? <span class="number">1</span> : i + <span class="number">1</span>;</span><br><span class="line">    all_dist += dist(points[i], points[j]);</span><br><span class="line">  &#125;</span><br><span class="line">  p0 /= all_dist;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; ++i) &#123;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%lf%lf%lf"</span>, &amp;stone[i].center.x, &amp;stone[i].center.y, &amp;stone[i].r);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;</span><br><span class="line">    <span class="keyword">if</span> (type[i]) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= m; ++j) &#123;</span><br><span class="line">        point v = stone[j].center - points[i];</span><br><span class="line">        <span class="keyword">double</span> angle = <span class="built_in">asin</span>(stone[j].r / dist(points[i], stone[j].center));</span><br><span class="line">        line a = line (points[i], rotate(v, angle), <span class="number">-1</span>);</span><br><span class="line">        line b = line (points[i], rotate(v, -angle), <span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">1</span>; k &lt;= n; ++k) &#123;</span><br><span class="line">          <span class="keyword">int</span> p = k == n ? <span class="number">1</span> : k + <span class="number">1</span>;</span><br><span class="line">          point intersection = line_intersection(line(points[k], points[p] - points[k], <span class="number">-1</span>), a);</span><br><span class="line">          <span class="keyword">if</span> (intersection != points[i] &amp;&amp; on_segment(intersection, points[k], points[p])) &#123;</span><br><span class="line">            cover[i].emplace_back(k &lt; i ? k + n : k, j, dist(points[k], intersection), intersection);</span><br><span class="line">          &#125;</span><br><span class="line">          intersection = line_intersection(line(points[k], points[p] - points[k], <span class="number">-1</span>), b);</span><br><span class="line">          <span class="keyword">if</span> (intersection != points[i] &amp;&amp; on_segment(intersection, points[k], points[p])) &#123;</span><br><span class="line">            cover[i].emplace_back(k &lt; i ? k + n : k, j, dist(points[k], intersection), intersection);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      sort(cover[i].begin(), cover[i].end());</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; v : cover[i]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (v.p_id &gt; n) &#123;</span><br><span class="line">          v.p_id -= n;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  add_edge();</span><br><span class="line">  <span class="keyword">double</span> l = <span class="number">0</span>, r = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (r - l &gt; <span class="number">1e-5</span>) &#123;</span><br><span class="line">    <span class="keyword">double</span> mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (check(mid)) &#123;</span><br><span class="line">      l = mid;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      r = mid;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"%.4lf\n"</span>, l);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</details>

<h1 id="D2T3-ABNS"><a href="#D2T3-ABNS" class="headerlink" title="D2T3 ABNS"></a>D2T3 ABNS</h1><h2 id="题目描述-4"><a href="#题目描述-4" class="headerlink" title="题目描述"></a>题目描述</h2><p>ABNS 生活在一个异次元宇宙中，在那个宇宙中，所有人都可以自由地进行时间旅行，这个宇宙的时间满足一个奇特的结构。人们可以自由地穿越到以前的任何一个时间点，并且从这个时间点开始产生一条新的时间线，很显然，这是一个树形结构。为了方便地管理每一位公民的时间旅行行为，成立了一个超脱时间线束缚的时空管理局，时空管理局负责协助公民进行时间旅行以及记录每一位公民的时间旅行树，时间树上的节点会有一个独一无二的索引 <code>index</code>，表示该节点的创建次序。即对于每一个新事件，时空管理局就会为相关的人员创建一个新的时间节点。</p>
<p>在那里的人们非常喜欢喝饮料，饮料店有许多饮品，一种饮料由三个参数表示，$a$ 表示卡路里含量，$b$ 表示花费，$c$ 表示美味度。（均为每单位体积，每种饮料总量无限）有时候 ABNS 嘴馋，想买一些混合味饮料，但对指标有严格控制，即热量（卡路里总含量）不能超过 $A$，花费不能超过 $B$，同时混合味饮料最美味。</p>
<p>由于 ABNS 是个十分挑剔的人，每次他买饮料的指标会有所变动。同时，饮料店为了满足尽可能多的顾客的需求，会在某些时候增加一种饮品。最后，ABNS 可能会在当前时间点选择穿越到另一个时间点。</p>
<h2 id="输入格式-4"><a href="#输入格式-4" class="headerlink" title="输入格式"></a>输入格式</h2><p>第一行一个整数 $n$ 表示总共 $n$ 个事件。</p>
<p>接下来 $n$ 行每行一种事件，事件为一下三种之一：</p>
<ol>
<li><code>add a b c</code>，表示饮品店上架了一种每单位体积卡路里、花费、美味度分别为 $a,b,c$ 的饮料。</li>
<li><code>buy A B</code>，表示 ABNS 来买饮料的口味指标为 $A$、$B$。（保证此时有饮料可买）</li>
<li><code>return index</code>，表示由于 ABNS 的时间旅行，时间跳到事件 <code>index</code>（事件从 $1$ 开始编号）之后（保证 <code>index</code> 是这之前某一个事件）。</li>
</ol>
<h2 id="输出格式-4"><a href="#输出格式-4" class="headerlink" title="输出格式"></a>输出格式</h2><p>对于每一个第二种操作，输出混合味饮料的最美味度，要求与答案的绝对误差或相对误差小于 $10^{-6}$。</p>
<h2 id="数据范围-4"><a href="#数据范围-4" class="headerlink" title="数据范围"></a>数据范围</h2><p><img src="3.png" alt=""></p>
<h2 id="题解-5"><a href="#题解-5" class="headerlink" title="题解"></a>题解</h2><p>每种饮料有三种属性$(A, B, C)$，我们将其“标准化”，即考虑每单位热量的花费以及美味度，那么这个属性会变成$(1, \frac BA, \frac CA)$</p>
<p>对于这种混合问题有一个经典的套路：我们将每种饮料看作二维平面上的一个点$(\frac BA, \frac CA)$，那么有这样一个结论：对于两种饮料$A, B$所代表的点，在$A, B$连线上的所有饮料都能通过适当地调配$A, B$得到</p>
<p>有了这个结论之后可以看出，实际上我们要求的就是所有饮料的上凸壳。如果我们求出了这个凸壳，在某一次询问的时候，我们找到$x = \frac BA$这条直线与凸壳的交点，这个交点的纵坐标乘以$A$就是答案</p>
<p>问题转化为维护这个凸包，直接维护可以获得$70$分的好成绩</p>
<p>可以发现所有的操作都形成了一棵树型的结构，对于每个点，其影响的询问为操作树中它的子树内的所有询问，对应一段连续的<code>dfs</code>序。类似标记永久化的方式，我们建一棵线段树，然后将这个点挂到线段树上那$\log$个区间上。对于线段树上的每个区间我们都求出这个区间上挂的所有点的凸包，查询的时候枚举当前询问在线段树上的所有祖先，在凸包上查询当前询问坐标的前驱后继。最后将这$O(\log n)$个前驱后继拿出来两两枚举就可以得到最终的答案</p>
<p>代码应该不长，但是咕了</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag"># 线段树</a>
              <a href="/tags/%E7%BD%91%E7%BB%9C%E6%B5%81/" rel="tag"># 网络流</a>
              <a href="/tags/LCT/" rel="tag"># LCT</a>
              <a href="/tags/%E8%AE%A1%E7%AE%97%E5%87%A0%E4%BD%95/" rel="tag"># 计算几何</a>
              <a href="/tags/%E5%90%AF%E5%8F%91%E5%BC%8F%E5%90%88%E5%B9%B6/" rel="tag"># 启发式合并</a>
              <a href="/tags/%E4%BA%8C%E6%AC%A1%E5%89%A9%E4%BD%99/" rel="tag"># 二次剩余</a>
              <a href="/tags/%E5%8D%8A%E5%B9%B3%E9%9D%A2%E4%BA%A4/" rel="tag"># 半平面交</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/04/08/47-lian-ce/" rel="prev" title="4.7联测">
      <i class="fa fa-chevron-left"></i> 4.7联测
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/04/21/CF643F-Bears-and-Juice/" rel="next" title="CF643F Bears and Juice">
      CF643F Bears and Juice <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#D1T1-树"><span class="nav-number">2.</span> <span class="nav-text">D1T1 树</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#题目描述"><span class="nav-number">2.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入格式"><span class="nav-number">2.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出格式"><span class="nav-number">2.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据范围"><span class="nav-number">2.4.</span> <span class="nav-text">数据范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#题解"><span class="nav-number">2.5.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#D1T2-Numazu-的蜜柑"><span class="nav-number">3.</span> <span class="nav-text">D1T2 Numazu 的蜜柑</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#题目描述-1"><span class="nav-number">3.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入格式-1"><span class="nav-number">3.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出格式-1"><span class="nav-number">3.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据范围-1"><span class="nav-number">3.4.</span> <span class="nav-text">数据范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#题解-1"><span class="nav-number">3.5.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#D1T3-星际迷航"><span class="nav-number">4.</span> <span class="nav-text">D1T3 星际迷航</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#题目描述-2"><span class="nav-number">4.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入格式-2"><span class="nav-number">4.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出格式-2"><span class="nav-number">4.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#题解-2"><span class="nav-number">4.4.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#D2T1-维护序列"><span class="nav-number">5.</span> <span class="nav-text">D2T1 维护序列</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#简化版题面"><span class="nav-number">5.1.</span> <span class="nav-text">简化版题面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据范围-2"><span class="nav-number">5.2.</span> <span class="nav-text">数据范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#题解-3"><span class="nav-number">5.3.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#D2T2-游泳池"><span class="nav-number">6.</span> <span class="nav-text">D2T2 游泳池</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#题目描述-3"><span class="nav-number">6.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入格式-3"><span class="nav-number">6.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出格式-3"><span class="nav-number">6.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据范围-3"><span class="nav-number">6.4.</span> <span class="nav-text">数据范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#题解-4"><span class="nav-number">6.5.</span> <span class="nav-text">题解</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#D2T3-ABNS"><span class="nav-number">7.</span> <span class="nav-text">D2T3 ABNS</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#题目描述-4"><span class="nav-number">7.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输入格式-4"><span class="nav-number">7.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#输出格式-4"><span class="nav-number">7.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据范围-4"><span class="nav-number">7.4.</span> <span class="nav-text">数据范围</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#题解-5"><span class="nav-number">7.5.</span> <span class="nav-text">题解</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="PlanarG"
      src="/images/77041874_p0_master12001.jpg">
  <p class="site-author-name" itemprop="name">PlanarG</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">197</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">66</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://planarg.top/" title="https:&#x2F;&#x2F;planarg.top&#x2F;">Title</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">PlanarG</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1.5,"jsonPath":"/live2dw/assets/histoire.model.json"},"display":{"position":"left","width":150,"height":300,"hOffset":35,"vOffset":-25},"mobile":{"show":false},"log":false});</script></body>
</html>
